{% extends 'base.html' %}
{% block content %}
<div class="page-wrapper">
    <div class="content">
        <div class="page-header">
            <div class="page-title">
                <h4>Bulk Purchase</h4>
            </div>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="alert-container">
            {% for category, message in messages %}
            <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        <form method="POST" action="/bulk_add_purchases">
            <!-- Inventory Dropdown -->
            <div class="form-group">
                <label for="inventory_id">Select Inventory</label>
                <select id="inventory_id" name="inventory_id" class="form-control" required>
                    <option value="" disabled selected>Choose an inventory</option>
                    {% for inventory in inventories %}
                    <option value="{{ inventory[0] }}">{{ inventory[1] }}({{ inventory[2] }})</option>
                    {% endfor %}
                </select>
            </div>

            <div class="card mt-3">
                <div class="card-body">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Raw Material</th>
                                <th>Quantity</th>
                                <th>Metric</th>
                                <th>Total Cost</th>
                                <th>Purchase Date</th>
                            </tr>
                        </thead>
                        <tbody id="raw-materials-table">
                            {% for material in raw_materials %}
                            <tr id="material-row-{{ material['id'] }}">
                                <td>
                                    <input type="text" name="material_{{ material['id'] }}"
                                        value="{{ material['name'] }}" class="form-control" readonly>
                                </td>
                                <td>
                                    <input type="number" name="quantity_{{ material['id'] }}"
                                        value="{{ material['last_quantity'] or '' }}" step="0.001" class="form-control"
                                        required>
                                </td>
                                <td>
                                    <select name="metric_{{ material['id'] }}" class="form-control" required>
                                        <option value="kg" {% if material['metric']=='kg' %}selected{% endif %}>kg
                                        </option>
                                        <option value="liter" {% if material['metric']=='liter' %}selected{% endif %}>
                                            liter</option>
                                        <option value="unit" {% if material['metric']=='unit' %}selected{% endif %}>unit
                                        </option>
                                    </select>
                                </td>
                                <td>
                                    <input type="number" name="total_cost_{{ material['id'] }}"
                                        value="{{ material['last_cost'] or '' }}" step="0.001" class="form-control"
                                        required>
                                </td>
                                <td>
                                    <input type="date" name="purchase_date_{{ material['id'] }}"
                                        value="{{ current_date }}" class="form-control" required>
                                </td>
                                <td>
                                    <button type="button" class="btn btn-danger btn-sm"
                                        onclick="removeRawMaterial('{{ material['id'] }}')">X</button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                    <div class="mt-3">
                        <button type="submit" class="btn btn-primary">Submit All</button>
                        <a href="/" class="btn btn-cancel">Cancel</a>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function removeRawMaterial(materialId) {
        // Locate the table row using the material ID and remove it
        const row = document.getElementById(`material-row-${materialId}`);
        if (row) {
            row.remove();
        }
    }
</script>
{% endblock %}
